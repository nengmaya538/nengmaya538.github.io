<section id="random-posts" class="post-grid">
  Memuat...
</section>

<div style="text-align:center; margin:20px;">
  <button id="load-more" style="
    background:#222;
    color:#fff;
    border:none;
    padding:10px 20px;
    border-radius:6px;
    cursor:pointer;
    font-size:15px;
    transition:background 0.3s ease;
  ">Load More Posts</button>
</div>

<style>
.post-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 10px;
  padding: 10px;
}

@media (min-width: 600px) {
  .post-grid {
    grid-template-columns: repeat(3, 1fr);
  }
}

@media (min-width: 1000px) {
  .post-grid {
    grid-template-columns: repeat(4, 1fr);
  }
}

.post-grid a {
  display: block;
  overflow: hidden;
  border-radius: 10px;
  background: #f8f8f8;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.post-grid a:hover {
  transform: scale(1.03);
  box-shadow: 0 3px 12px rgba(0,0,0,0.1);
}

.post-grid img {
  width: 100%;
  height: auto;
  display: block;
  object-fit: cover;
  opacity: 0;
  transition: opacity 0.5s ease;
}

.post-grid img.loaded {
  opacity: 1;
}

#load-more:hover {
  background:#444;
}
</style>

<script>
let allPosts = [];
let currentIndex = 0;
const batchSize = 12; // jumlah posting per klik
const container = document.getElementById('random-posts');
const button = document.getElementById('load-more');

fetch('/posts.json')
  .then(res => res.json())
  .then(data => {
    // Acak urutan postingan
    allPosts = data.sort(() => Math.random() - 0.5);
    // Tampilkan batch pertama
    renderPosts();
  })
  .catch(err => {
    console.error('Gagal memuat posts.json:', err);
    container.innerText = 'Gagal memuat data postingan.';
  });

function renderPosts() {
  const nextBatch = allPosts.slice(currentIndex, currentIndex + batchSize);

  const html = nextBatch.map(post => `
    <a href="${post.url}">
      <img src="${post.image}" alt="${post.title}" loading="lazy">
    </a>
  `).join('');

  container.insertAdjacentHTML('beforeend', html);
  fadeInImages();

  currentIndex += batchSize;

  // Sembunyikan tombol jika sudah habis
  if (currentIndex >= allPosts.length) {
    button.style.display = 'none';
  }
}

function fadeInImages() {
  const imgs = container.querySelectorAll('img:not(.loaded)');
  imgs.forEach(img => {
    if (img.complete) {
      img.classList.add('loaded');
    } else {
      img.addEventListener('load', () => img.classList.add('loaded'));
    }
  });
}

button.addEventListener('click', renderPosts);
</script>
