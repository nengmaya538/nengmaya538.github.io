{% assign max_related = 50 %}
{% assign count = 0 %}

<div class="related-posts">
  <h2>Related Articles</h2>

  {% for level in (5..1) %}
    {% for post in site.posts %}
      {% if post.url != page.url %}

        {% assign score = 0 %}
        {% for cat in page.categories %}
          {% if post.categories contains cat %}
            {% assign score = score | plus: 1 %}
          {% endif %}
        {% endfor %}

        {% if score == level %}

          <div class="related-item">

            <h3>
              <a href="{{ post.url | relative_url }}">
                {{ post.title }}
              </a>
            </h3>

            <!-- Excerpt ambil <p> pertama -->
            <div class="excerpt">
              {{ post.content | split: '</p>' | first | append: '</p>' }}
            </div>

            <div class="meta">

              {% if post.categories %}
                <div>
                  Categories:
                  {% for cat in post.categories %}
                    <a href="/categories/?q={{ cat | slugify }}">
                      {{ cat }}
                    </a>{% unless forloop.last %}, {% endunless %}
                  {% endfor %}
                </div>
              {% endif %}

              {% if post.tags %}
                <div>
                  Tags:
                  {% for tag in post.tags %}
                    <a href="/tags/?q={{ tag | slugify }}">
                      {{ tag }}
                    </a>{% unless forloop.last %}, {% endunless %}
                  {% endfor %}
                </div>
              {% endif %}

              {% if post.labels %}
                <div>
                  Labels:
                  {% for label in post.labels %}
                    <a href="/labels/?q={{ label | slugify }}">
                      {{ label }}
                    </a>{% unless forloop.last %}, {% endunless %}
                  {% endfor %}
                </div>
              {% endif %}

              {% if post.keywords %}
                <div>
                  Keywords:
                  {% for kw in post.keywords %}
                    <a href="/keywords/?q={{ kw | slugify }}">
                      {{ kw }}
                    </a>{% unless forloop.last %}, {% endunless %}
                  {% endfor %}
                </div>
              {% endif %}

            </div>

          </div>

          {% assign count = count | plus: 1 %}
          {% if count >= max_related %}
            {% break %}
          {% endif %}

        {% endif %}

      {% endif %}
    {% endfor %}
  {% endfor %}

</div>

<style>
.related-posts {
  margin-top: 60px;
  padding-top: 25px;
  border-top: 1px solid #eee;
}

.related-posts h2 {
  font-size: 20px;
  margin-bottom: 20px;
}

.related-item {
  margin-bottom: 35px;
}

.related-item h3 {
  font-size: 18px;
  margin-bottom: 6px;
}

.related-item h3 a {
  text-decoration: none;
}

.related-item h3 a:hover {
  text-decoration: underline;
}

.related-item .excerpt {
  font-size: 14px;
  color: #555;
  margin-bottom: 8px;
}

.related-item .meta {
  font-size: 12px;
  color: #888;
}

.related-item .meta a {
  text-decoration: none;
}

.related-item .meta a:hover {
  text-decoration: underline;
}
</style>
